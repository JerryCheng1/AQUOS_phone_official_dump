# Copyright (c) 2016, SHARP CORPORATION. All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are
# met:
#     * Redistributions of source code must retain the above copyright
#       notice, this list of conditions and the following disclaimer.
#     * Redistributions in binary form must reproduce the above
#       copyright notice, this list of conditions and the following
#       disclaimer in the documentation and/or other materials provided
#       with the distribution.
#     * Neither the name of The Linux Foundation nor the names of its
#       contributors may be used to endorse or promote products derived
#       from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED "AS IS" AND ANY EXPRESS OR IMPLIED
# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT
# ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS
# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
# OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
# IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
#

import /vendor/etc/init/hw/init.common.rc
import /vendor/etc/init/hw/init.sharp.usb.rc

on early-init
    mkdir /durable 0700 root root
    mkdir /oemlog 0771 system system

on init
    write /sys/bus/msm_subsys/devices/subsys3/restart_level RELATED
    write /sys/module/lpm_levels/system/pwr/pwr-l2-gdhs/idle_enabled N
    write /sys/module/lpm_levels/system/perf/perf-l2-gdhs/idle_enabled N

on fs
    wait /dev/block/bootdevice/by-name/durable
    mount ext4 /dev/block/bootdevice/by-name/durable /durable noatime nosuid nodev barrier=1

    wait /dev/block/bootdevice/by-name/tombstones
    mount ext4 /dev/block/bootdevice/by-name/tombstones /oemlog noatime nosuid nodev barrier=1

on post-fs
    mkdir /durable/lost+found 0770 root root
    restorecon_recursive /durable

    mkdir /oemlog/lost+found 0770 root root
    restorecon_recursive /oemlog

on post-fs-data
# set properties which are customized for sharp devices
    setprop telephony.lteOnCdmaDevice 0
    setprop persist.radio.calls.on.ims true
    setprop persist.radio.domain.ps false
    setprop persist.radio.jbims 1
    setprop persist.radio.vrte_logic 1
    setprop persist.radio.ROTATION_ENABLE 0
    setprop persist.vendor.radio.mt_sms_ack 20
    setprop persist.vendor.radio.report_rstate 1
    setprop persist.vendor.radio.no_cons_man_roam 1
    setprop persist.vendor.radio.block_allow_data 1
    setprop persist.vendor.radio.rcv_dormancy_ind on
    setprop persist.radio.apn_delay 5000
    setprop mdc_initial_max_retry 10
    setprop persist.radio.sw_mbn_update 0
    setprop persist.audio.fluence.voicecall false
    setprop persist.audio.fluence.speaker false
    setprop audio.offload.pcm.16bit.enable false
    setprop audio.offload.pcm.24bit.enable false
    setprop audio.offload.disable 1
    setprop persist.debug.wfd.enable 0
    setprop debug.mdpcomp.idletime 250
    setprop persist.vendor.radio.reject_cause_21 1
    setprop persist.data.iwlan.enable false

    mkdir /oemlog/modem 0771 system system
    mkdir /data/nfc 0770 nfc nfc
    mkdir /data/nfc/param 0770 nfc nfc
    mkdir /data/system/nfc 0770 root nfc
    mkdir /data/tmp 711 root system

on boot
    insmod /vendor/lib/modules/shexfat.ko

# Start the service for SHPA
service shpa_process /vendor/bin/shpa_process
    class core
    user system
    oneshot
    group graphics

service shssrd /vendor/bin/shssrd
    class main
    user root
    group root

# Start the service for display
service display_process /vendor/bin/display_process
    class main

# Start shdiag in diagnostic mode for sharp eve.
service shdiag /vendor/bin/shdiag
    class core
    disabled
    oneshot
    seclabel u:r:sh_diag:s0

on property:ro.boot.wakeinfo=64 && property:sys.usb.config=obex
    start shdiag

on property:ro.boot.wakeinfo=68 && property:sys.usb.config=obex
    start shdiag

on property:ro.boot.wakeinfo=64 && property:sys.usb.config=obex,adb
    start shdiag

on property:ro.boot.wakeinfo=68 && property:sys.usb.config=obex,adb
    start shdiag

on property:ro.boot.wakeinfo=64 && property:sys.usb.config=obex,adb,diag
    start shdiag

on property:ro.boot.wakeinfo=68 && property:sys.usb.config=obex,adb,diag
    start shdiag

# Start shsoftupdate in software update mode for sharp eve.
service shsoftupdate /vendor/bin/shsoftupdate
    class core
    disabled
    seclabel u:r:sh_diag:s0

on property:ro.boot.wakeinfo=1 && property:vold.decrypt=trigger_restart_framework
    start shsoftupdate

service shlogd /vendor/bin/shlogd
    class main
    group system sdcard_rw

service init_shlogd /vendor/bin/sh /vendor/etc/shlogd/init.sharp.shlogd.sh
    disabled
    oneshot

on property:sys.boot_completed=1
    start init_shlogd

on property:ro.boot.wakeinfo=32
    start shlogd

on property:ro.boot.wakeinfo=33
    start shlogd

# Start shrmts which provides I/F in modem to access to eMMC for sharp eve.
service shrmts_usr /vendor/bin/shrmts_usr
    class core

service tftp /system/bin/tftp_server
    class main
    user root
